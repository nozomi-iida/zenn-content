---
title: "ECS on EC2でデプロイする"
emoji: "🎃"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

最近 AWS の ECS on EC2 を使ってアプリをデプロイしたので今回はそこで学んだデプロイの方法を復習がてらまとめてみようと思います。

## インフラ構成図

![infra_structure](https://storage.googleapis.com/zenn-user-upload/0849780b1165-20230417.png)

今回は ECS on EC2 を使ってデプロイするので、インフラ構成図は以下のようになります。
Nginx のサーバをデプロイするようにします。
VPC や Subnet、 EC2 に関しては今回は詳しく解説しません。
ECS 周りを重点的に解説します。

## ECS とは？

ECS は Amazon Elastic Container Service の略で、コンテナを管理するためのサービスです。
コンテナを管理するためのサービスということは、コンテナを作成したり、コンテナを実行したり、コンテナを停止したり、コンテナを削除したりすることができます。
注意することは、コンテナを管理するためのサービスなので、コンテナを実行するためのインフラ(EC2, Fargate)は用意する必要があるということです。

## コンテナとは？

ECS を使用するにあたって、まずはコンテナという概念を理解する必要があるので一応復習しておきます。
コンテナとは、アプリケーションを実行するための環境です。
コンテナは、アプリケーションを実行するための環境なので、アプリケーションを実行するためのプログラムやライブラリ、設定ファイルなどを含んでいます。

ECS の概要をみるだけではあんまりピンとこないと思うので、実際に ECS を触ってみましょう。

## クラスターを作成する

まずはクラスターを用意します。
クラスターとは、コンテナを実行するためのインフラをまとめたものです。

クラスと名と、ネットワーキング設定
![](https://storage.googleapis.com/zenn-user-upload/d645559dce1a-20230428.png)
ネットワークはデフォルトの vpc、サブネットを使用します。

インフラストラクチャ
![](https://storage.googleapis.com/zenn-user-upload/e1c112211980-20230428.png)

インフラストラクチャは ECS on EC2 を実現したいので、Amazon EC2 インスタンスを用意してクラスターを作成します。

## タスクを作成する

次にタスクを作成します。
タスクとは、コンテナを実行するための定義です。
タスクを作成すると、コンテナを実行するための定義が作成されます。
個人的には `docker-compose.yml` と似ていると思いました。

![](https://storage.googleapis.com/zenn-user-upload/7f59f6155ab4-20230428.png)
イメージは`nginx:latest`を使用します。

![](https://storage.googleapis.com/zenn-user-upload/1334b135c464-20230428.png)
ステップ 2 ではアプリケーションをデプロイする環境を`EC2`にします。
タスクサイズが少し注意が必要なのですが、タスクサイズは `Amazon Elastic Container Service > クラスター > nginx-cluster > インフラストラクチャ` で設定したインスタンスタイプに合わせる必要があります。

![](https://storage.googleapis.com/zenn-user-upload/677e4ee520ea-20230428.png)
先程作ったクラスターの環境だと使用可能な CPU が 1024, 使用可能なメモリが 970 なので、タスクサイズはその数字よりも以下のように設定しました。

## ロードバランサーを作成する

## サービスを作成する
