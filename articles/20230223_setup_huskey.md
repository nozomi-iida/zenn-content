---
title: "huskyã‚’å°å…¥ã—ã¦ã‚³ãƒ¼ãƒ‰å“è³ªã‚’æ‹…ä¿ã™ã‚‹"
emoji: "ğŸ“˜"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [react, husky, lint-staged, nextjs]
published: true
---

## husky ã¨ã¯ï¼Ÿ

husky ã¯ git ã®ãƒ•ãƒƒã‚¯ã‚’åˆ©ç”¨ã—ã¦ã‚³ãƒ¼ãƒ‰å“è³ªã‚’æ‹…ä¿ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
git ã®ãƒ•ãƒƒã‚¯ã¨ã¯ã€git ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹éš›ã«è‡ªå‹•çš„ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ã“ã¨ã§ã™ã€‚
husky ã¯ git ã®ãƒ•ãƒƒã‚¯ã‚’åˆ©ç”¨ã—ã¦ã€ã‚³ãƒŸãƒƒãƒˆå‰ã«ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ãŸã‚Šã€ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## å°å…¥æ–¹æ³•

ä»Šå›ã¯å¤‰æ›´ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ã®ã‚³ãƒ¼ãƒ‰æ•´å½¢ã‚’å®Ÿè¡Œã™ã‚‹ãƒ•ãƒƒã‚¯ã¨ã€ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãƒ•ãƒƒã‚¯ã‚’è¨­å®šã—ã¦ã¿ã¾ã™ã€‚

### 1. husky ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹

```bash
npx husky-init && npm install
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§`.husky`ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã€package.json ã« husky ã®è¨­å®šãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚

### 2. ã‚³ãƒŸãƒƒãƒˆå‰ã« eslint ã‚’å®Ÿè¡Œã™ã‚‹ãƒ•ãƒƒã‚¯ã‚’è¨­å®šã™ã‚‹

```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npm run lint
```

ã“ã®çŠ¶æ…‹ã§ã‚³ãƒŸãƒƒãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€å¤‰æ›´ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ eslint ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
ã“ã‚Œã§ husky ã®å°å…¥ã¯å®Œäº†ã§ã™ã€‚
æ¬¡ã¯å¤‰æ›´ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ã®ã¿ã‚³ãƒ¼ãƒ‰æ•´å½¢ã‚’å®Ÿè¡Œã™ã‚‹ãƒ•ãƒƒã‚¯ã‚’è¨­å®šã—ã¦ã¿ã¾ã™ã€‚

## å¤‰æ›´ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ã®ã¿ã‚³ãƒ¼ãƒ‰æ•´å½¢ã‚’å®Ÿè¡Œã™ã‚‹ãƒ•ãƒƒã‚¯ã‚’è¨­å®šã™ã‚‹

å¤‰æ›´ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ã®ã¿ã‚³ãƒ¼ãƒ‰æ•´å½¢ã‚’å®Ÿè¡Œã™ã‚‹ãƒ•ãƒƒã‚¯ã‚’è¨­å®šã™ã‚‹ã«ã¯ã€`lint-staged`ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

### 1. lint-staged ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹

```bash
npm install lint-staged --save-dev
```

### 2. `.lintstagedrc`ã‚’ä½œæˆã™ã‚‹

```bash
touch .lintstagedrc
```

```json
{
  "**/*.{js,jsx,ts,tsx}": ["prettier --write", "eslint --fix"]
}
```

ã“ã‚Œã§é©å½“ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ã¦`npm run lins-staged`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€å¤‰æ›´ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ã®ã¿ã‚³ãƒ¼ãƒ‰æ•´å½¢ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

## lint-staged ã¨ husky ã‚’çµ„ã¿åˆã‚ã›ã‚‹

lint-staged ã¨ husky ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€ã‚³ãƒŸãƒƒãƒˆå‰ã«å¤‰æ›´ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ã®ã¿ã‚³ãƒ¼ãƒ‰æ•´å½¢ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```bash:pre-commit
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

yarn lint-staged
```

ã“ã‚Œã§ã‚³ãƒŸãƒƒãƒˆå‰ã«å¤‰æ›´ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ã®ã¿ã‚³ãƒ¼ãƒ‰æ•´å½¢ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

## ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãƒ•ãƒƒã‚¯ã‚’è¨­å®šã™ã‚‹

`commitlint`ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãƒ•ãƒƒã‚¯ã‚’è¨­å®šã—ã¦ã¿ã¾ã™ã€‚

### 1. commitlint ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹

```bash
npm install @commitlint/cli @commitlint/config-conventional --save-dev
echo "module.exports = {extends: ['@commitlint/config-conventional']}" > commitlint.config.js
```

commitlint ãŒæ­£ã—ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹ãŸã‚ã«ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

```bash
echo 'foo: bar' | commitlint
â§—   input: foo: bar
âœ–   type must be one of [build, chore, ci, docs, feat, fix, perf, refactor, revert, style, test] [type-enum]

âœ–   found 1 problems, 0 warnings
â“˜   Get help: https://github.com/conventional-changelog/commitlint/#what-is-commitlint
```

ã“ã‚“ãªæ„Ÿã˜ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚Œã°æ­£ã—ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã™ã€‚

### 2. ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãƒ•ãƒƒã‚¯ã‚’è¨­å®šã™ã‚‹

```bash
npm run husky add .husky/commit-msg 'yarn commitlint --edit "$1"'
```

ã“ã‚Œã§å¤‰æ›´ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ã®ã‚³ãƒ¼ãƒ‰æ•´å½¢ã‚’å®Ÿè¡Œã™ã‚‹ãƒ•ãƒƒã‚¯ã¨ã€ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ãƒã‚§ãƒƒã‚¯ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã€ã‚³ãƒ¼ãƒ‰å“è³ªã‚’æ‹…ä¿ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## å‚è€ƒ

@[card](https://typicode.github.io/husky/#/)
@[card](https://git-scm.com/book/ja/v2/Git-%E3%81%AE%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA-Git-%E3%83%95%E3%83%83%E3%82%AF)
@[card](https://commitlint.js.org/#/)
